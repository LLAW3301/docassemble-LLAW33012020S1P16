# SACAT Legal Assistance App Main 
---
objects:
  - endpoint: DADict
---
# app metadata
metadata:
  title: SACAT Legal Assistance App
  authors:
    - name: Rhea Jolley
    - name: Ioanna Moliviatis
    - name: Mary Nguyen
    - name: Jashoda Rawat
  organisation:  Flinders University
---
# Interview help button, pretty cool feature we could include
interview help:
  heading: About this interview
  content: |
    Whatever we want here!!
---
# This will include the other files
include:
  - JIRM_SERVICES.yml
  - JIRM_questionblock.yml
  - JIRM_process.yml
---
# SACAT Welcome Screen
mandatory: True
question: Welcome to the SACAT Legal Assistance Web App
subquestion: |
  This application is designed to help you find services that may assist you in the following matters:  

  * Housing
  * Births, deaths and marriages
  * Equal opportunity
  * Other administratrative and community matters
  
  **Disclaimer:**  
  The service provided by this application is to provide contact details and resources   for legal services in South Australia. No guarantees can be made that any individual   service will provide services or advice to you.

  **Do you understand and accept these terms and wish to continue?**

buttons:
  - "I accept and want to continue": continue
  - "I do not accept": exit
    url: http://www.sacat.sa.gov.au/
---
# This is the ineligible endpoint
event: endpoint['JIRMineligible']
question: Eligibility requirements not met
subquestion:
  Unfortunately, SACAT is only able to assist users whose matter is based in South Australia. Please refer to your state's Civil and Administrative Tribunal.
buttons:
  - Exit: exit
    url: http://www.sacat.sa.gov.au/
  - Restart: restart
---
# This is the eligibility block that decides where you go
mandatory: True
code: |
  if JIRMresidency == 'Yes':
    endpoint['JIRMeligible']
  else:
    endpoint['JIRMineligible']
---
# JIRM Screen that says: thank you for completing the eligibility and matter q's
continue button field: JIRMpersonal_details_permission
question: |
  Personal Details
subquestion: |
  Thank you for completing the eligibility and matter questions. The application will now ask for your personal details in order to compile a list of relevant legal services for your matter.
  
---
# JIRM LAST SCREEN IF ALL IS ELIGIBLE
# All variables must be included here to trigger their question block
# Do NOT forget to add attachment!!!!!!!!!!!!!!!!!!
event: endpoint['JIRMeligible']
question: Results 
subquestion: |
  ### Thanks for using the SACAT Legal Service Assistance App! 
  ${ JIRMasked } 
  Dear ${ JIRMname },
  
  Thanks for using the SACAT Legal Service Assistance App, accessed on ${ format_date(today(), format='EEEE, d MMMM yyyy') } at ${ format_time(current_datetime()) }.
  
  A list of relevant legal and advisory servicecs have been compiled relating to your matter thanks to the information provided. Contact details and location for each service have been provided for your convenience. In addition, a downloadable PDF document has been created with the information you provided and the legal services applicable to your matter.

  Here are your answers. 

  Questions|Answers
  -------|-------
  Salutation|${ JIRMsalutation }
  Full Name|${ JIRMname }
  Age|${ JIRMage } 
  Gender|${ JIRMgender }
  Indigenous Australian?|${ JIRMaboriginalortsi }
  Postcode|${ JIRMpostcode }
  Matter in SA?|${ JIRMresidency } 
  English as a first language?|${ JIRMesl }
  %if JIRMesl == 'No':
  Interpreter|${ JIRMinterpreter } 
  %endif 
  Matter|${ JIRMmatter } 
  %if JIRMmatter == 'Housing':
  Specifics|${ JIRMhousingmatter }
  %endif
  %if JIRMmatter == 'Births, deaths and marriages':
  Specifics|${ JIRMbdmmatter }
  %endif
  %if JIRMmatter == 'Equal Opportunity':
  Specifics|${ JIRMeomatter }
  %endif
  %if JIRMmatter == 'Other administrative and community matters':
  Specifics|${ JIRMadmincommatter }
  %endif
  
   Based on your answers, we have generated a list of legal services that can assist in your matter.
   
   *Create LIST*
  
  Would you like to see a complete list of legal services?
  
  *DO A SHOW IF THAT WILL SHOW THE COMPLETE LIST
  Here is a complete list of legal services.
  
  ${ JIRMcolumn_header }
  ${ JIRMdashes }
  %for JIRMitem in JIRMtable_rows:
  ${ JIRMitem }
  %endfor
  
  You also have the option to download a PDF containing all the information above for your future reference. 
  
attachment:
  docx template file: BLANK_JINJA.docx

buttons:
  - I'm done: exit
    url: http://www.sacat.sa.gov.au/
  - Do it again: restart
---
# Code block to ask matter questions and display nothing
code: |
  JIRMmatter
  JIRMpersonal_details_permission
  JIRMasked = ''
---
# Everything below creates the table
---
# Creates the column header
code: |
  # This makes the column header empty
  JIRMcolumn_header = ""
  
  # We access the first list element and iterate through its keys
  for JIRMitem in JIRMlegalservices[0]:
    JIRMcolumn_header += JIRMitem + '|'
  
  # This gets rid of the last '|'
  JIRMcolumn_header = JIRMcolumn_header[:-1]
---
# Creates the dashes for the table header 
code: |
  # We iterate up to one short of the length of the dictionary so the last pipe doesn't need to be taken off.
  JIRMdashes = "---"
  for i in range(len(JIRMlegalservices[0]) - 1):
    JIRMdashes += "|---"
---
# This constructs a list for display as the rows of the table.
code: | 
  # Initialise empty list
  JIRMtable_rows = []
  
  # First loop.  Iterate through each list element putting each dictionary
  # into JIRMitem
  for JIRMitem in JIRMlegalservices:
      # Second loop.  Get the keys so we can get the values
      # But before we start, initialise a temporary variable in which
      # we construct the Markdown table row
      JIRMrow = ""
      for JIRMkey in JIRMitem:
        JIRMrow += str(JIRMitem[JIRMkey]) + '|'
      # Trim the last pipe
      JIRMrow = JIRMrow[:-1]
      # Add to the list
      JIRMtable_rows.append(JIRMrow)
---